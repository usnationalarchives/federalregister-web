<% page_title @search.term.blank? ? 'Document Search' : "Document Search Results for '#{@search.term}'" %>

<% if @search.valid? %>
  <% feed_autodiscovery(
    documents_search_api_path(
      {conditions: @search.valid_conditions.except(:publication_date)},
      format: :rss
    ),
    @search.summary,
    search_conditions: @search.valid_conditions.except(:publication_date)
  ) %>
<% end %>

<% if @search.blank? %>
  <% description 'Easy, powerful search of all Federal Register documents since 1994' %>
<% end %>

<%= add_javascript src: 'page_specific/search' %>

<%= title do %>
  <%= fr_icon 'Search' %>
  Document Search
<% end %>

<%= bootstrap_context_wrapper do %>
  <div class="row document-search search">
    <div class="<%= bootstrap_col(xs: 12, md: 12) %>">

      <%= esi(documents_search_header_path(params)) %>

      <% unless @search.conditions_blank? %>
        <% if @search.valid? %>
          <div class="row">
            <% if @search.results.present? %>
              <div class="<%= bootstrap_col(xs: 3, md: 3) %>">
                <div class="facets">
                  <%= esi( documents_search_facets_path(
                      @presenter.params.merge(facet: 'publication_date')
                    )
                  ) unless @search.publication_date.present? %>

                  <%= esi( documents_search_facets_path(
                      @presenter.params.merge(facet: 'type')
                    )
                  ) unless @search.type.present? %>

                  <%= esi( documents_search_facets_path(
                      @presenter.params.merge(facet: 'agency', num_facets: 6, limit: 12)
                    )
                  ) unless @search.agencies.present? %>

                  <%= esi( documents_search_facets_path(
                      @presenter.params.merge(facet: 'topic', num_facets: 6)
                    )
                  ) unless @search.topics.present? %>

                  <%= esi( documents_search_facets_path(
                      @presenter.params.merge(facet: 'section', num_facets: 6)
                    )
                  ) unless @search.sections.present? || @search.section_ids.present? %>
                </div>
              </div>
            <% end %>

            <% col_span = @search.results.present? ? 9 : 12 %>
            <div class="<%= bootstrap_col(xs: col_span, md: col_span) %>">
              <% if (@presenter.params[:page].blank? || @presenter.params[:page] == '1') &&
                @presenter.params[:order].blank? %>
                <%= esi documents_search_suggestions_path(@presenter.params)%>
              <% end %>

              <%= esi(documents_search_results_path(@presenter.params)) %>
            </div>
          </div>
        <% else %>
          <div class="flash-message error">
            <h5>
              We encountered some errors with your search, please correct them and try again.
            </h5>

            <ul class="bullets">
              <% @search.validation_errors.values.each do |err| %>
                <li class=""><%= err %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
      <% end %>

    </div>
  </div>
<% end %>
